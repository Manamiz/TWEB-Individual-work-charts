<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <link rel="stylesheet" type="text/css" href="css/bootstrap-3.3.5-dist/css/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="css/bootstrap-3.3.5-dist/css/bootstrap-theme.min.css">
      <link rel="stylesheet" type="text/css" href="css/chart/angular-chart.css">
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <title>Individual Work - Charts</title>
   </head>
   <body ng-app="app">
      <nav class="navbar navbar-default">
        <div class="container-fluid container">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">TWEB - Individual work - Charts</a>
          </div>

          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Audience <span class="sr-only">(current)</span></a></li>
              <li><a href="#">Board</a></li>
              <li><a href="#">Debug</a></li>
            </ul>
          </div>
        </div>
      </nav>

      <div ng-controller="DoughnutCtrl" class="container">
         <h1>Are you happy ?</h1>

         <div class="btn-group btn-group-justified" role="group" aria-label="...">
           <div class="btn-group" role="group">
             <button type="button" class="btn btn-info" onclick="sendVote('yes');">Yes</button>
           </div>
           <div class="btn-group" role="group">
             <button type="button" class="btn btn-info" onclick="sendVote('no');">No</button>
           </div>
           <div class="btn-group" role="group">
             <button type="button" class="btn btn-info" onclick="sendVote('idontknow');">I don't know</button>
           </div>
         </div>

         <canvas id="doughnut" class="chart chart-doughnut" chart-data="data" chart-labels="labels"></canvas>
      </div>

      <script src="js/jquery/jquery.min.js"></script>
      <script src="js/angular/angular.min.js"></script>
      <script src="js/chart/chart.js"></script>
      <script src="js/chart/angular-chart.js"></script>
      <script src="js/socket/socket.js"></script>
      <script src="/socket.io/socket.io.js"></script>
      <script>
         var socket = io();

         function sendVote(type) {
            socket.emit(type, {});
         }

         angular.module("app", ["chart.js", "btford.socket-io"])
         .factory('socket', function (socketFactory) {
           return socketFactory();
         })
         .controller("DoughnutCtrl", function($scope, socket) {
            socket.forward('updateVotes', $scope);
            socket.forward('initVotes', $scope);
            $scope.$on('socket:initVotes', function (ev, data) {
               $scope.labels = ["Yes", "No", "I don't know"];
               $scope.data = [data['yes'], data['no'], data['idontknow']];
            });
            $scope.$on('socket:updateVotes', function (ev, data) {
               $scope.data = [data['yes'], data['no'], data['idontknow']];
            });
         });
      </script>
   </body>
</html>